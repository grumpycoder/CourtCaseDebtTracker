(function () {
    'use strict';

    var module = angular.module('app', [
        //third party modules
        'ui.bootstrap',
        'ngSanitize',
        'ui.select'
    ]);

    module.run(function () {
        console.log('Application Started');
    })
})();
//case-detail.component.js
(function () {
    var module = angular.module('app');

    function controller($http, $modal, uibDateParser) {
        var $ctrl = this;

        $ctrl.title = 'Case Manager';
        $ctrl.subTitle = 'Case';
        $ctrl.isBusy = false;

        $ctrl.$onInit = function () {
            console.log('case detail init');
            var id = location.pathname.split('/')[location.pathname.split('/').length - 1];
            $ctrl.isBusy = true;
            $http.get('/api/case/' + id).then(function (r) {
                $ctrl.case = r.data;
            }).finally(function () {
                $ctrl.isBusy = false;
            });
        }

        $ctrl.openModal = function () {
            $modal.open({
                component: 'caseEdit',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    case: $ctrl.case
                },
                size: 'md'
            }).result.then(function (result) {
                console.log('updated', result);
                angular.extend($ctrl.case, result);
            }, function (reason) {});
        }

        $ctrl.addLitigant = function (type) {
            if ($ctrl.plaintiff !== undefined) {
                console.log('add plaintiff', $ctrl.plaintiff.name);
                $ctrl.plaintiff.caseId = $ctrl.case.id;
                $ctrl.plaintiff.type = 'plaintiff';

                $http.post('/api/case/' + $ctrl.case.id + '/litigant', $ctrl.plaintiff)
                    .then(function (r) {
                        $ctrl.case.plaintiffs.unshift(r.data);
                        $ctrl.plaintiff = undefined;
                    });
            }
            if ($ctrl.defendant !== undefined) {
                $ctrl.defendant.caseId = $ctrl.case.id;
                $ctrl.defendant.type = 'defendant';

                console.log('add defendant', $ctrl.defendant);
                $http.post('/api/case/' + $ctrl.case.id + '/litigant', $ctrl.defendant)
                    .then(function (r) {
                        $ctrl.case.defendants.unshift(r.data);
                        $ctrl.defendant = undefined;
                    });
            }
        }

        $ctrl.deleteLitigant = function (item, type) {
            console.log('litigant', item);
            console.log('type', type);
            $http.delete('/api/case/' + $ctrl.case.id + '/litigant/' + item.id).then(function (r) {
                switch (type) {
                    case 'defendant':
                        var idx = $ctrl.case.defendants.indexOf(item);
                        $ctrl.case.defendants.splice(idx, 1);
                        break;
                    case 'plaintiff':
                        var idx = $ctrl.case.plaintiffs.indexOf(item);
                        $ctrl.case.plaintiffs.splice(idx, 1);
                        break;
                    default:
                        console.log('unknown litigant');
                }
            }).catch(function (err) {
                // toastr.error('Oops. Error deleting tax');
            }).finally(function () {
                // $ctrl.isBusy = false;
            });

        }

    }

    module.component('caseDetail', {
        templateUrl: '/app/cases/case-detail.component.html',
        controller: ['$http', '$uibModal', 'uibDateParser', controller]
    });
})();
//case-edit.component.js
(function () {
    var module = angular.module('app');

    function controller($http, uibDateParser) {
        var $ctrl = this;
        $ctrl.title = 'Update Case';
        $ctrl.dateFormat = "MM/DD/YYYY";
        $ctrl.dateOptions = {
            minDate: '1940-01-01'
        };

        $ctrl.$onInit = function () {
            console.log('case edit init');
            if ($ctrl.resolve) {
                $ctrl.case = angular.copy($ctrl.resolve.case);

                var isValidDate = moment($ctrl.resolve.case.dateFiled).isValid();
                if (moment($ctrl.resolve.case.dateFiled).isValid()) {
                    $ctrl.case.dateFiled = new Date($ctrl.case.dateFiled);
                } else {
                    $ctrl.case.dateFiled = new Date();
                }
            }
            if ($ctrl.case === undefined) {
                $ctrl.title = 'New Case';
            }

            $http.get('/api/court/list').then(function (r) {
                $ctrl.courts = r.data;
            })
        }

        $ctrl.cancel = function () {
            $ctrl.dismiss();
        }

        $ctrl.save = function () {
            if ($ctrl.case.id !== undefined) {
                $http.put('/api/case', $ctrl.case).then(function (r) {
                    $ctrl.modalInstance.close(r.data);
                });
            } else {
                $http.post('/api/case', $ctrl.case).then(function (r) {
                    $ctrl.modalInstance.close(r.data);
                });
            }
        }


    }

    module.component('caseEdit', {
        templateUrl: '/app/cases/case-edit.component.html',
        controller: ['$http', controller],
        bindings: {
            case: '<',
            resolve: '<',
            close: '&',
            dismiss: '&',
            modalInstance: '<'
        }
    });
})();
//case-list.component.js
(function () {
    var module = angular.module('app');

    function controller($http, $modal) {
        var $ctrl = this;

        $ctrl.title = 'Case Manager';
        $ctrl.subTitle = 'Cases';
        $ctrl.isBusy = false;

        $ctrl.$onInit = function () {
            console.log('case list init');
            $ctrl.isBusy = true;
            $http.get('api/case/list').then(function (r) {
                $ctrl.cases = r.data;
                console.log('cases', $ctrl.cases);
            }).finally(function () {
                $ctrl.isBusy = false;
            });
        }

        $ctrl.openModal = function () {
            $modal.open({
                component: 'caseEdit',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    case: $ctrl.case
                },
                size: 'md'
            }).result.then(function (result) {
                console.log('result', result);
                $ctrl.cases.unshift(result);
            }, function (reason) {});
        }

    }

    module.component('caseList', {
        templateUrl: 'app/cases/case-list.component.html',
        controller: ['$http', '$uibModal', controller]
    });
})();
//court-edit.component.js
(function () {
    var module = angular.module('app');

    function controller($http) {
        var $ctrl = this;

        $ctrl.title = 'Update Court';

        $ctrl.$onInit = function () {
            console.log('court edit init', $ctrl);
            $http.get('api/jurisdiction/list').then(function (r) {
                $ctrl.jurisdictions = r.data;
                console.log('jurisdictions', $ctrl.jurisdictions);
            });

            if ($ctrl.resolve) {
                $ctrl.court = angular.copy($ctrl.resolve.court);
            }
            if ($ctrl.court === undefined) {
                $ctrl.title = 'New Court';
            }
        }

        $ctrl.cancel = function () {
            $ctrl.dismiss();
        }

        $ctrl.save = function () {
            console.log('save', $ctrl.court);
            if ($ctrl.court.id !== undefined) {
                console.log('updating court', $ctrl.court);
                $http.put('api/court', $ctrl.court).then(function (r) {
                    $ctrl.modalInstance.close($ctrl.court);
                });
            } else {
                console.log('adding new court', $ctrl.court);
                $http.post('api/court', $ctrl.court).then(function (r) {
                    $ctrl.modalInstance.close($ctrl.court);
                });
            }
        }

    }

    module.component('courtEdit', {
        templateUrl: '/app/courts/court-edit.component.html',
        controller: ['$http', controller],
        bindings: {
            court: '<',
            resolve: '<',
            close: '&',
            dismiss: '&',
            modalInstance: '<'
        }
    });
})();
//court-list.component.js
(function () {
    var module = angular.module('app');

    function controller($http, $modal) {
        var $ctrl = this;

        $ctrl.title = 'Court Manager';
        $ctrl.subTitle = 'Courts';
        $ctrl.isBusy = false;

        $ctrl.$onInit = function () {
            console.log('court list init');
            $ctrl.isBusy = true;
            $http.get('api/court/list').then(function (r) {
                console.log('r', r);
                $ctrl.courts = r.data;
            }).finally(function () {
                $ctrl.isBusy = false;
            });
        }

        $ctrl.openModal = function (court) {
            console.log('selected', court);
            $modal.open({
                component: 'courtEdit',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    court: court
                },
                size: 'md'
            }).result.then(function (result) {
                console.log('updated', result);
                if (court !== undefined) {
                    angular.extend(court, result);
                } else {
                    $ctrl.courts.unshift(result);
                }
            }, function (reason) {});
        }
    }

    module.component('courtList', {
        templateUrl: 'app/courts/court-list.component.html',
        controller: ['$http', '$uibModal', controller]
    });
})();
//mark.lawrence
//date-input.directive.js

(function () {
    angular.module('app').directive('dateInput', function ($window) {
        return {
            require: '^ngModel',
            restrict: 'A',
            link: function (scope, elm, attrs, ctrl) {
                var moment = $window.moment;
                var dateFormat = attrs.dateInput;

                attrs.$observe('dateInput', function (newValue) {
                    console.log('newValue', newValue);
                    if (dateFormat === newValue || !ctrl.$modelValue) return;

                    dateFormat = newValue;
                    ctrl.$modelValue = moment(ctrl.$setViewValue).format(dateFormat);
                    console.log('datevalue', $ctrl.modelValue);
                });

                ctrl.$formatters.unshift(function (modelValue) {
                    if (!dateFormat || !modelValue) return "";
                    var retVal = moment(modelValue).format(dateFormat);
                    return retVal;
                });

                ctrl.$parsers.unshift(function (viewValue) {
                    var date = moment(viewValue, dateFormat);
                    return (date && date.isValid() && date.year() > 1950) ? date.toDate() : "";
                });
            }
        };
    });
})();
//jurisdiction-edit.component.js
(function () {
    var module = angular.module('app');

    function controller($http) {
        var $ctrl = this;

        $ctrl.title = 'Update Jurisdiction';

        $ctrl.$onInit = function () {
            console.log('jurisdiction edit init', $ctrl);
            if ($ctrl.resolve) {
                $ctrl.jurisdiction = angular.copy($ctrl.resolve.jurisdiction);
            }
            if ($ctrl.jurisdiction === undefined) {
                $ctrl.title = 'New Jurisdiction'
            }
        }

        $ctrl.cancel = function () {
            $ctrl.dismiss();
        }

        $ctrl.save = function () {
            console.log('save', $ctrl.jurisdiction);
            if ($ctrl.jurisdiction.id !== undefined) {
                $http.put('api/jurisdiction', $ctrl.jurisdiction).then(function (r) {
                    $ctrl.modalInstance.close($ctrl.jurisdiction);
                });
            } else {
                $http.post('api/jurisdiction', $ctrl.jurisdiction).then(function (r) {
                    $ctrl.modalInstance.close($ctrl.jurisdiction);
                });
            }
        }


    }

    module.component('jurisdictionEdit', {
        templateUrl: 'app/jurisdictions/jurisdiction-edit.component.html',
        controller: ['$http', controller],
        bindings: {
            jurisdiction: '<',
            resolve: '<',
            close: '&',
            dismiss: '&',
            modalInstance: '<'
        }
    });
})();
//jurisdiction-list.component.js
(function () {
    var module = angular.module('app');

    function controller($http, $modal) {
        var $ctrl = this;

        $ctrl.title = 'Jurisdiction Manager';
        $ctrl.subTitle = 'Jurisdictions';
        $ctrl.isBusy = false;

        $ctrl.$onInit = function () {
            console.log('jurisdiction list init');
            $ctrl.isBusy = true;
            $http.get('api/jurisdiction/list').then(function (r) {
                console.log('r', r);
                $ctrl.jurisdictions = r.data;
            }).finally(function () {
                $ctrl.isBusy = false;
            });
        }

        $ctrl.selectJurisidiction = function (j) {
            console.log('select', j);
            $ctrl.selectedJurisidiction = j;
        }

        $ctrl.openModal = function (jurisdiction) {
            console.log('selected', jurisdiction);
            $modal.open({
                component: 'jurisdictionEdit',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    jurisdiction: jurisdiction
                },
                size: 'md'
            }).result.then(function (result) {
                console.log('updated', result);
                if (jurisdiction === undefined) {
                    $ctrl.jurisdictions.unshift(result);
                } else {
                    angular.extend(jurisdiction, result);
                }
            }, function (reason) {});
        }
    }

    module.component('jurisdictionList', {
        templateUrl: 'app/jurisdictions/jurisdiction-list.component.html',
        controller: ['$http', '$uibModal', controller]
    });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjYXNlcy9jYXNlLWRldGFpbC5jb21wb25lbnQuanMiLCJjYXNlcy9jYXNlLWVkaXQuY29tcG9uZW50LmpzIiwiY2FzZXMvY2FzZS1saXN0LmNvbXBvbmVudC5qcyIsImNvdXJ0cy9jb3VydC1lZGl0LmNvbXBvbmVudC5qcyIsImNvdXJ0cy9jb3VydC1saXN0LmNvbXBvbmVudC5qcyIsImRpcmVjdGl2ZXMvZGF0ZS1pbnB1dC5qcyIsImp1cmlzZGljdGlvbnMvanVyaXNkaWN0aW9uLWVkaXQuY29tcG9uZW50LmpzIiwianVyaXNkaWN0aW9ucy9qdXJpc2RpY3Rpb24tbGlzdC5jb21wb25lbnQuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDN0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDL0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNsREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJywgW1xuICAgICAgICAvL3RoaXJkIHBhcnR5IG1vZHVsZXNcbiAgICAgICAgJ3VpLmJvb3RzdHJhcCcsXG4gICAgICAgICduZ1Nhbml0aXplJyxcbiAgICAgICAgJ3VpLnNlbGVjdCdcbiAgICBdKTtcblxuICAgIG1vZHVsZS5ydW4oZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnQXBwbGljYXRpb24gU3RhcnRlZCcpO1xuICAgIH0pXG59KSgpOyIsIi8vY2FzZS1kZXRhaWwuY29tcG9uZW50LmpzXG4oZnVuY3Rpb24gKCkge1xuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XG5cbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRodHRwLCAkbW9kYWwsIHVpYkRhdGVQYXJzZXIpIHtcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcblxuICAgICAgICAkY3RybC50aXRsZSA9ICdDYXNlIE1hbmFnZXInO1xuICAgICAgICAkY3RybC5zdWJUaXRsZSA9ICdDYXNlJztcbiAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7XG5cbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjYXNlIGRldGFpbCBpbml0Jyk7XG4gICAgICAgICAgICB2YXIgaWQgPSBsb2NhdGlvbi5wYXRobmFtZS5zcGxpdCgnLycpW2xvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KCcvJykubGVuZ3RoIC0gMV07XG4gICAgICAgICAgICAkY3RybC5pc0J1c3kgPSB0cnVlO1xuICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2Nhc2UvJyArIGlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgJGN0cmwuY2FzZSA9IHIuZGF0YTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAkY3RybC5vcGVuTW9kYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnY2FzZUVkaXQnLFxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2U6ICRjdHJsLmNhc2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndXBkYXRlZCcsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoJGN0cmwuY2FzZSwgcmVzdWx0KTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHt9KTtcbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLmFkZExpdGlnYW50ID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgICAgIGlmICgkY3RybC5wbGFpbnRpZmYgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhZGQgcGxhaW50aWZmJywgJGN0cmwucGxhaW50aWZmLm5hbWUpO1xuICAgICAgICAgICAgICAgICRjdHJsLnBsYWludGlmZi5jYXNlSWQgPSAkY3RybC5jYXNlLmlkO1xuICAgICAgICAgICAgICAgICRjdHJsLnBsYWludGlmZi50eXBlID0gJ3BsYWludGlmZic7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL2Nhc2UvJyArICRjdHJsLmNhc2UuaWQgKyAnL2xpdGlnYW50JywgJGN0cmwucGxhaW50aWZmKVxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGN0cmwuY2FzZS5wbGFpbnRpZmZzLnVuc2hpZnQoci5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjdHJsLnBsYWludGlmZiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJGN0cmwuZGVmZW5kYW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5kZWZlbmRhbnQuY2FzZUlkID0gJGN0cmwuY2FzZS5pZDtcbiAgICAgICAgICAgICAgICAkY3RybC5kZWZlbmRhbnQudHlwZSA9ICdkZWZlbmRhbnQnO1xuXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2FkZCBkZWZlbmRhbnQnLCAkY3RybC5kZWZlbmRhbnQpO1xuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcGkvY2FzZS8nICsgJGN0cmwuY2FzZS5pZCArICcvbGl0aWdhbnQnLCAkY3RybC5kZWZlbmRhbnQpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkY3RybC5jYXNlLmRlZmVuZGFudHMudW5zaGlmdChyLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGN0cmwuZGVmZW5kYW50ID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLmRlbGV0ZUxpdGlnYW50ID0gZnVuY3Rpb24gKGl0ZW0sIHR5cGUpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdsaXRpZ2FudCcsIGl0ZW0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3R5cGUnLCB0eXBlKTtcbiAgICAgICAgICAgICRodHRwLmRlbGV0ZSgnL2FwaS9jYXNlLycgKyAkY3RybC5jYXNlLmlkICsgJy9saXRpZ2FudC8nICsgaXRlbS5pZCkudGhlbihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdkZWZlbmRhbnQnOlxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9ICRjdHJsLmNhc2UuZGVmZW5kYW50cy5pbmRleE9mKGl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGN0cmwuY2FzZS5kZWZlbmRhbnRzLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3BsYWludGlmZic6XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gJGN0cmwuY2FzZS5wbGFpbnRpZmZzLmluZGV4T2YoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkY3RybC5jYXNlLnBsYWludGlmZnMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1bmtub3duIGxpdGlnYW50Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIC8vIHRvYXN0ci5lcnJvcignT29wcy4gRXJyb3IgZGVsZXRpbmcgdGF4Jyk7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyAkY3RybC5pc0J1c3kgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIG1vZHVsZS5jb21wb25lbnQoJ2Nhc2VEZXRhaWwnLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9jYXNlcy9jYXNlLWRldGFpbC5jb21wb25lbnQuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAnJHVpYk1vZGFsJywgJ3VpYkRhdGVQYXJzZXInLCBjb250cm9sbGVyXVxuICAgIH0pO1xufSkoKTsiLCIvL2Nhc2UtZWRpdC5jb21wb25lbnQuanNcbihmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcblxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJGh0dHAsIHVpYkRhdGVQYXJzZXIpIHtcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcbiAgICAgICAgJGN0cmwudGl0bGUgPSAnVXBkYXRlIENhc2UnO1xuICAgICAgICAkY3RybC5kYXRlRm9ybWF0ID0gXCJNTS9ERC9ZWVlZXCI7XG4gICAgICAgICRjdHJsLmRhdGVPcHRpb25zID0ge1xuICAgICAgICAgICAgbWluRGF0ZTogJzE5NDAtMDEtMDEnXG4gICAgICAgIH07XG5cbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjYXNlIGVkaXQgaW5pdCcpO1xuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5jYXNlID0gYW5ndWxhci5jb3B5KCRjdHJsLnJlc29sdmUuY2FzZSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgaXNWYWxpZERhdGUgPSBtb21lbnQoJGN0cmwucmVzb2x2ZS5jYXNlLmRhdGVGaWxlZCkuaXNWYWxpZCgpO1xuICAgICAgICAgICAgICAgIGlmIChtb21lbnQoJGN0cmwucmVzb2x2ZS5jYXNlLmRhdGVGaWxlZCkuaXNWYWxpZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICRjdHJsLmNhc2UuZGF0ZUZpbGVkID0gbmV3IERhdGUoJGN0cmwuY2FzZS5kYXRlRmlsZWQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRjdHJsLmNhc2UuZGF0ZUZpbGVkID0gbmV3IERhdGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJGN0cmwuY2FzZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgJGN0cmwudGl0bGUgPSAnTmV3IENhc2UnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY291cnQvbGlzdCcpLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5jb3VydHMgPSByLmRhdGE7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgJGN0cmwuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJGN0cmwuZGlzbWlzcygpO1xuICAgICAgICB9XG5cbiAgICAgICAgJGN0cmwuc2F2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICgkY3RybC5jYXNlLmlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJy9hcGkvY2FzZScsICRjdHJsLmNhc2UpLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwubW9kYWxJbnN0YW5jZS5jbG9zZShyLmRhdGEpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCcvYXBpL2Nhc2UnLCAkY3RybC5jYXNlKS50aGVuKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgICAgICRjdHJsLm1vZGFsSW5zdGFuY2UuY2xvc2Uoci5kYXRhKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cbiAgICB9XG5cbiAgICBtb2R1bGUuY29tcG9uZW50KCdjYXNlRWRpdCcsIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2Nhc2VzL2Nhc2UtZWRpdC5jb21wb25lbnQuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCBjb250cm9sbGVyXSxcbiAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgIGNhc2U6ICc8JyxcbiAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcbiAgICAgICAgICAgIGNsb3NlOiAnJicsXG4gICAgICAgICAgICBkaXNtaXNzOiAnJicsXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTsiLCIvL2Nhc2UtbGlzdC5jb21wb25lbnQuanNcbihmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcblxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJGh0dHAsICRtb2RhbCkge1xuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xuXG4gICAgICAgICRjdHJsLnRpdGxlID0gJ0Nhc2UgTWFuYWdlcic7XG4gICAgICAgICRjdHJsLnN1YlRpdGxlID0gJ0Nhc2VzJztcbiAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7XG5cbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjYXNlIGxpc3QgaW5pdCcpO1xuICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gdHJ1ZTtcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL2Nhc2UvbGlzdCcpLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5jYXNlcyA9IHIuZGF0YTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2FzZXMnLCAkY3RybC5jYXNlcyk7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgJGN0cmwub3Blbk1vZGFsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ2Nhc2VFZGl0JyxcbiAgICAgICAgICAgICAgICBiaW5kaW5nczoge1xuICAgICAgICAgICAgICAgICAgICBtb2RhbEluc3RhbmNlOiBcIjxcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICBjYXNlOiAkY3RybC5jYXNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Jlc3VsdCcsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgJGN0cmwuY2FzZXMudW5zaGlmdChyZXN1bHQpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge30pO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBtb2R1bGUuY29tcG9uZW50KCdjYXNlTGlzdCcsIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAvY2FzZXMvY2FzZS1saXN0LmNvbXBvbmVudC5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsICckdWliTW9kYWwnLCBjb250cm9sbGVyXVxuICAgIH0pO1xufSkoKTsiLCIvL2NvdXJ0LWVkaXQuY29tcG9uZW50LmpzXG4oZnVuY3Rpb24gKCkge1xuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XG5cbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRodHRwKSB7XG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XG5cbiAgICAgICAgJGN0cmwudGl0bGUgPSAnVXBkYXRlIENvdXJ0JztcblxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvdXJ0IGVkaXQgaW5pdCcsICRjdHJsKTtcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL2p1cmlzZGljdGlvbi9saXN0JykudGhlbihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgICRjdHJsLmp1cmlzZGljdGlvbnMgPSByLmRhdGE7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2p1cmlzZGljdGlvbnMnLCAkY3RybC5qdXJpc2RpY3Rpb25zKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAoJGN0cmwucmVzb2x2ZSkge1xuICAgICAgICAgICAgICAgICRjdHJsLmNvdXJ0ID0gYW5ndWxhci5jb3B5KCRjdHJsLnJlc29sdmUuY291cnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCRjdHJsLmNvdXJ0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAkY3RybC50aXRsZSA9ICdOZXcgQ291cnQnO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgJGN0cmwuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJGN0cmwuZGlzbWlzcygpO1xuICAgICAgICB9XG5cbiAgICAgICAgJGN0cmwuc2F2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzYXZlJywgJGN0cmwuY291cnQpO1xuICAgICAgICAgICAgaWYgKCRjdHJsLmNvdXJ0LmlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndXBkYXRpbmcgY291cnQnLCAkY3RybC5jb3VydCk7XG4gICAgICAgICAgICAgICAgJGh0dHAucHV0KCdhcGkvY291cnQnLCAkY3RybC5jb3VydCkudGhlbihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKCRjdHJsLmNvdXJ0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2FkZGluZyBuZXcgY291cnQnLCAkY3RybC5jb3VydCk7XG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnYXBpL2NvdXJ0JywgJGN0cmwuY291cnQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwubW9kYWxJbnN0YW5jZS5jbG9zZSgkY3RybC5jb3VydCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIG1vZHVsZS5jb21wb25lbnQoJ2NvdXJ0RWRpdCcsIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL2NvdXJ0cy9jb3VydC1lZGl0LmNvbXBvbmVudC5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsIGNvbnRyb2xsZXJdLFxuICAgICAgICBiaW5kaW5nczoge1xuICAgICAgICAgICAgY291cnQ6ICc8JyxcbiAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcbiAgICAgICAgICAgIGNsb3NlOiAnJicsXG4gICAgICAgICAgICBkaXNtaXNzOiAnJicsXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTsiLCIvL2NvdXJ0LWxpc3QuY29tcG9uZW50LmpzXG4oZnVuY3Rpb24gKCkge1xuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XG5cbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRodHRwLCAkbW9kYWwpIHtcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcblxuICAgICAgICAkY3RybC50aXRsZSA9ICdDb3VydCBNYW5hZ2VyJztcbiAgICAgICAgJGN0cmwuc3ViVGl0bGUgPSAnQ291cnRzJztcbiAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7XG5cbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjb3VydCBsaXN0IGluaXQnKTtcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XG4gICAgICAgICAgICAkaHR0cC5nZXQoJ2FwaS9jb3VydC9saXN0JykudGhlbihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyJywgcik7XG4gICAgICAgICAgICAgICAgJGN0cmwuY291cnRzID0gci5kYXRhO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLm9wZW5Nb2RhbCA9IGZ1bmN0aW9uIChjb3VydCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlbGVjdGVkJywgY291cnQpO1xuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ2NvdXJ0RWRpdCcsXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgY291cnQ6IGNvdXJ0XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3VwZGF0ZWQnLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgIGlmIChjb3VydCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGNvdXJ0LCByZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRjdHJsLmNvdXJ0cy51bnNoaWZ0KHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge30pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnY291cnRMaXN0Jywge1xuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9jb3VydHMvY291cnQtbGlzdC5jb21wb25lbnQuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAnJHVpYk1vZGFsJywgY29udHJvbGxlcl1cbiAgICB9KTtcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXG4vL2RhdGUtaW5wdXQuZGlyZWN0aXZlLmpzXG5cbihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnZGF0ZUlucHV0JywgZnVuY3Rpb24gKCR3aW5kb3cpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlcXVpcmU6ICdebmdNb2RlbCcsXG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbG0sIGF0dHJzLCBjdHJsKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1vbWVudCA9ICR3aW5kb3cubW9tZW50O1xuICAgICAgICAgICAgICAgIHZhciBkYXRlRm9ybWF0ID0gYXR0cnMuZGF0ZUlucHV0O1xuXG4gICAgICAgICAgICAgICAgYXR0cnMuJG9ic2VydmUoJ2RhdGVJbnB1dCcsIGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnbmV3VmFsdWUnLCBuZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChkYXRlRm9ybWF0ID09PSBuZXdWYWx1ZSB8fCAhY3RybC4kbW9kZWxWYWx1ZSkgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgICAgIGRhdGVGb3JtYXQgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgY3RybC4kbW9kZWxWYWx1ZSA9IG1vbWVudChjdHJsLiRzZXRWaWV3VmFsdWUpLmZvcm1hdChkYXRlRm9ybWF0KTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2RhdGV2YWx1ZScsICRjdHJsLm1vZGVsVmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY3RybC4kZm9ybWF0dGVycy51bnNoaWZ0KGZ1bmN0aW9uIChtb2RlbFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghZGF0ZUZvcm1hdCB8fCAhbW9kZWxWYWx1ZSkgcmV0dXJuIFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXRWYWwgPSBtb21lbnQobW9kZWxWYWx1ZSkuZm9ybWF0KGRhdGVGb3JtYXQpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmV0VmFsO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgY3RybC4kcGFyc2Vycy51bnNoaWZ0KGZ1bmN0aW9uICh2aWV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRhdGUgPSBtb21lbnQodmlld1ZhbHVlLCBkYXRlRm9ybWF0KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChkYXRlICYmIGRhdGUuaXNWYWxpZCgpICYmIGRhdGUueWVhcigpID4gMTk1MCkgPyBkYXRlLnRvRGF0ZSgpIDogXCJcIjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9KTtcbn0pKCk7IiwiLy9qdXJpc2RpY3Rpb24tZWRpdC5jb21wb25lbnQuanNcbihmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcblxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJGh0dHApIHtcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcblxuICAgICAgICAkY3RybC50aXRsZSA9ICdVcGRhdGUgSnVyaXNkaWN0aW9uJztcblxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2p1cmlzZGljdGlvbiBlZGl0IGluaXQnLCAkY3RybCk7XG4gICAgICAgICAgICBpZiAoJGN0cmwucmVzb2x2ZSkge1xuICAgICAgICAgICAgICAgICRjdHJsLmp1cmlzZGljdGlvbiA9IGFuZ3VsYXIuY29weSgkY3RybC5yZXNvbHZlLmp1cmlzZGljdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJGN0cmwuanVyaXNkaWN0aW9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAkY3RybC50aXRsZSA9ICdOZXcgSnVyaXNkaWN0aW9uJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgJGN0cmwuY2FuY2VsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJGN0cmwuZGlzbWlzcygpO1xuICAgICAgICB9XG5cbiAgICAgICAgJGN0cmwuc2F2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzYXZlJywgJGN0cmwuanVyaXNkaWN0aW9uKTtcbiAgICAgICAgICAgIGlmICgkY3RybC5qdXJpc2RpY3Rpb24uaWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICRodHRwLnB1dCgnYXBpL2p1cmlzZGljdGlvbicsICRjdHJsLmp1cmlzZGljdGlvbikudGhlbihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKCRjdHJsLmp1cmlzZGljdGlvbik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJ2FwaS9qdXJpc2RpY3Rpb24nLCAkY3RybC5qdXJpc2RpY3Rpb24pLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwubW9kYWxJbnN0YW5jZS5jbG9zZSgkY3RybC5qdXJpc2RpY3Rpb24pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cblxuICAgIH1cblxuICAgIG1vZHVsZS5jb21wb25lbnQoJ2p1cmlzZGljdGlvbkVkaXQnLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2p1cmlzZGljdGlvbnMvanVyaXNkaWN0aW9uLWVkaXQuY29tcG9uZW50Lmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiBbJyRodHRwJywgY29udHJvbGxlcl0sXG4gICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICBqdXJpc2RpY3Rpb246ICc8JyxcbiAgICAgICAgICAgIHJlc29sdmU6ICc8JyxcbiAgICAgICAgICAgIGNsb3NlOiAnJicsXG4gICAgICAgICAgICBkaXNtaXNzOiAnJicsXG4gICAgICAgICAgICBtb2RhbEluc3RhbmNlOiAnPCdcbiAgICAgICAgfVxuICAgIH0pO1xufSkoKTsiLCIvL2p1cmlzZGljdGlvbi1saXN0LmNvbXBvbmVudC5qc1xuKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xuXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCwgJG1vZGFsKSB7XG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XG5cbiAgICAgICAgJGN0cmwudGl0bGUgPSAnSnVyaXNkaWN0aW9uIE1hbmFnZXInO1xuICAgICAgICAkY3RybC5zdWJUaXRsZSA9ICdKdXJpc2RpY3Rpb25zJztcbiAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7XG5cbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdqdXJpc2RpY3Rpb24gbGlzdCBpbml0Jyk7XG4gICAgICAgICAgICAkY3RybC5pc0J1c3kgPSB0cnVlO1xuICAgICAgICAgICAgJGh0dHAuZ2V0KCdhcGkvanVyaXNkaWN0aW9uL2xpc3QnKS50aGVuKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3InLCByKTtcbiAgICAgICAgICAgICAgICAkY3RybC5qdXJpc2RpY3Rpb25zID0gci5kYXRhO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLnNlbGVjdEp1cmlzaWRpY3Rpb24gPSBmdW5jdGlvbiAoaikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlbGVjdCcsIGopO1xuICAgICAgICAgICAgJGN0cmwuc2VsZWN0ZWRKdXJpc2lkaWN0aW9uID0gajtcbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLm9wZW5Nb2RhbCA9IGZ1bmN0aW9uIChqdXJpc2RpY3Rpb24pIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZWxlY3RlZCcsIGp1cmlzZGljdGlvbik7XG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnanVyaXNkaWN0aW9uRWRpdCcsXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAganVyaXNkaWN0aW9uOiBqdXJpc2RpY3Rpb25cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygndXBkYXRlZCcsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgaWYgKGp1cmlzZGljdGlvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICRjdHJsLmp1cmlzZGljdGlvbnMudW5zaGlmdChyZXN1bHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGp1cmlzZGljdGlvbiwgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7fSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBtb2R1bGUuY29tcG9uZW50KCdqdXJpc2RpY3Rpb25MaXN0Jywge1xuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9qdXJpc2RpY3Rpb25zL2p1cmlzZGljdGlvbi1saXN0LmNvbXBvbmVudC5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsICckdWliTW9kYWwnLCBjb250cm9sbGVyXVxuICAgIH0pO1xufSkoKTsiXX0=
