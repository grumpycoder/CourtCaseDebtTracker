(function () {
    'use strict';

    var module = angular.module('app', [
        //third party modules
        'ui.bootstrap',
        'ngSanitize',
        'ui.select',
        'angular-confirm',
        'ngToast',
        'smart-table'
    ]);

    module.run(function () {
        console.log('Application Started');
    })
})();
//case-detail.component.js
(function () {
    var module = angular.module('app');

    function controller($http, $modal, uibDateParser, $confirm, ngToast) {
        var $ctrl = this;

        $ctrl.title = 'Case Manager';
        $ctrl.subTitle = 'Case';
        $ctrl.isBusy = false;

        $ctrl.$onInit = function () {
            console.log('case detail init');
            var id = location.pathname.split('/')[location.pathname.split('/').length - 1];
            $ctrl.isBusy = true;
            $http.get('/api/case/' + id).then(function (r) {
                $ctrl.case = r.data;
            }).finally(function () {
                $ctrl.isBusy = false;
            });
        }

        $ctrl.openModal = function () {
            $modal.open({
                component: 'caseEdit',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    case: $ctrl.case
                },
                size: 'md'
            }).result.then(function (result) {
                console.log('updated', result);
                angular.extend($ctrl.case, result);
            }, function (reason) {});
        }

        $ctrl.addLitigant = function (type) {
            if ($ctrl.plaintiff !== undefined) {
                console.log('add plaintiff', $ctrl.plaintiff.name);
                $ctrl.plaintiff.caseId = $ctrl.case.id;
                $ctrl.plaintiff.type = 'plaintiff';

                $http.post('/api/case/' + $ctrl.case.id + '/litigant', $ctrl.plaintiff)
                    .then(function (r) {
                        $ctrl.case.plaintiffs.unshift(r.data);
                        $ctrl.plaintiff = undefined;
                    });
            }
            if ($ctrl.defendant !== undefined) {
                $ctrl.defendant.caseId = $ctrl.case.id;
                $ctrl.defendant.type = 'defendant';

                console.log('add defendant', $ctrl.defendant);
                $http.post('/api/case/' + $ctrl.case.id + '/litigant', $ctrl.defendant)
                    .then(function (r) {
                        $ctrl.case.defendants.unshift(r.data);
                        $ctrl.defendant = undefined;
                    });
            }
        }

        $ctrl.deleteLitigant = function (item, type) {
            console.log('litigant', item);
            console.log('type', type);
            $http.delete('/api/case/' + $ctrl.case.id + '/litigant/' + item.id).then(function (r) {
                switch (type) {
                    case 'defendant':
                        var idx = $ctrl.case.defendants.indexOf(item);
                        $ctrl.case.defendants.splice(idx, 1);
                        break;
                    case 'plaintiff':
                        var idx = $ctrl.case.plaintiffs.indexOf(item);
                        $ctrl.case.plaintiffs.splice(idx, 1);
                        break;
                    default:
                        console.log('unknown litigant');
                }
            }).catch(function (err) {
                // toastr.error('Oops. Error deleting tax');
            }).finally(function () {
                // $ctrl.isBusy = false;
            });

        }

        $ctrl.delete = function () {
            $confirm({
                title: 'Delete',
                text: 'Are you sure you want to delete ' + $ctrl.case.caption + '?'
            }).then(function () {

                $http.delete('/api/case/' + $ctrl.case.id).then(function (r) {
                    var myToastMsg = ngToast.success({
                        content: 'Deleted case ' + $ctrl.case.caption,
                        dismissButton: true
                    });
                    window.location.href = '/';
                }).catch(function (err) {
                    console.log('Oops. Something went wrong', err);
                    var myToastMsg = ngToast.danger({
                        content: err.data,
                        dismissButton: true
                    });
                });
            });

        }
    }

    module.component('caseDetail', {
        templateUrl: '/app/cases/case-detail.component.html',
        controller: ['$http', '$uibModal', 'uibDateParser', '$confirm', 'ngToast', controller]
    });
})();
//case-edit.component.js
(function () {
    var module = angular.module('app');

    function controller($http, uibDateParser) {
        var $ctrl = this;
        $ctrl.title = 'Update Case';
        $ctrl.dateFormat = "MM/DD/YYYY";
        $ctrl.dateOptions = {
            minDate: '1940-01-01'
        };

        $ctrl.$onInit = function () {
            console.log('case edit init');
            if ($ctrl.resolve) {
                $ctrl.case = angular.copy($ctrl.resolve.case);
                console.log('case', $ctrl.case);

                if ($ctrl.case !== undefined) {
                    $ctrl.case.dateFiled = new Date($ctrl.case.dateFiled);
                } else {
                    $ctrl.case = {
                        dateFiled: new Date()
                    };
                }
            }
            if ($ctrl.case === undefined) {
                $ctrl.title = 'New Case';
            }

            $http.get('/api/court/list').then(function (r) {
                $ctrl.courts = r.data;
            })
        }

        $ctrl.cancel = function () {
            $ctrl.dismiss();
        }

        $ctrl.save = function () {
            if ($ctrl.case.id !== undefined) {
                $http.put('/api/case', $ctrl.case).then(function (r) {
                    $ctrl.modalInstance.close(r.data);
                });
            } else {
                $http.post('/api/case', $ctrl.case).then(function (r) {
                    $ctrl.modalInstance.close(r.data);
                });
            }
        }


    }

    module.component('caseEdit', {
        templateUrl: '/app/cases/case-edit.component.html',
        controller: ['$http', controller],
        bindings: {
            case: '<',
            resolve: '<',
            close: '&',
            dismiss: '&',
            modalInstance: '<'
        }
    });
})();
//case-list.component.js
(function () {
    var module = angular.module('app');

    function controller($http, $modal, ngToast) {
        var $ctrl = this;
        var pageSizeDefault = 10;

        $ctrl.title = 'Case Manager';
        $ctrl.subTitle = 'Cases';
        $ctrl.isBusy = false;

        $ctrl.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            orderBy: 'id',
            orderDirection: 'desc'
        };

        $ctrl.$onInit = function () {
            console.log('case list init');
            $ctrl.isBusy = true;
        }

        $ctrl.search = function (tableState) {
            tableStateRef = tableState;
            $ctrl.isBusy = true;

            if (typeof (tableState.sort.predicate) !== "undefined") {
                $ctrl.searchModel.orderBy = tableState.sort.predicate;
                $ctrl.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }

            $http.get('api/case/list', {
                params: $ctrl.searchModel
            }).then(function (r) {
                $ctrl.cases = r.data.results;
                $ctrl.searchModel = r.data;
                delete $ctrl.searchModel.results;
            }).finally(function () {
                $ctrl.isBusy = false;
            });
        }

        $ctrl.paged = function paged() {
            $ctrl.search(tableStateRef);
        };

        $ctrl.openModal = function () {
            $modal.open({
                component: 'caseEdit',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    case: $ctrl.case
                },
                size: 'md'
            }).result.then(function (result) {
                console.log('result', result);
                $ctrl.cases.unshift(result);
                var myToastMsg = ngToast.success({
                    content: 'Added case ' + result.caption,
                    dismissButton: true
                });
            }, function (reason) {});
        }

    }

    module.component('caseList', {
        templateUrl: 'app/cases/case-list.component.html',
        controller: ['$http', '$uibModal', 'ngToast', controller]
    });
})();
//court-edit.component.js
(function () {
    var module = angular.module('app');

    function controller($http) {
        var $ctrl = this;

        $ctrl.title = 'Update Court';

        $ctrl.$onInit = function () {
            console.log('court edit init', $ctrl);
            $http.get('api/jurisdiction/list').then(function (r) {
                $ctrl.jurisdictions = r.data;
            });

            if ($ctrl.resolve) {
                $ctrl.court = angular.copy($ctrl.resolve.court);
            }
            if ($ctrl.court === undefined) {
                $ctrl.title = 'New Court';
            }
        }

        $ctrl.cancel = function () {
            $ctrl.dismiss();
        }

        $ctrl.save = function () {
            console.log('save', $ctrl.court);
            if ($ctrl.court.id !== undefined) {
                console.log('updating court', $ctrl.court);
                $http.put('api/court', $ctrl.court).then(function (r) {
                    $ctrl.modalInstance.close($ctrl.court);
                });
            } else {
                console.log('adding new court', $ctrl.court);
                $http.post('api/court', $ctrl.court).then(function (r) {
                    $ctrl.modalInstance.close(r.data);
                });
            }
        }

    }

    module.component('courtEdit', {
        templateUrl: '/app/courts/court-edit.component.html',
        controller: ['$http', controller],
        bindings: {
            court: '<',
            resolve: '<',
            close: '&',
            dismiss: '&',
            modalInstance: '<'
        }
    });
})();
//court-list.component.js
(function () {
    var module = angular.module('app');

    function controller($http, $modal, $confirm, ngToast) {
        var $ctrl = this;
        var pageSizeDefault = 10;

        $ctrl.title = 'Court Manager';
        $ctrl.subTitle = 'Courts';
        $ctrl.isBusy = false;

        $ctrl.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            orderBy: 'id',
            orderDirection: 'desc'
        };

        $ctrl.$onInit = function () {
            console.log('court list init');
            $ctrl.isBusy = true;
        }

        $ctrl.search = function (tableState) {
            tableStateRef = tableState;
            $ctrl.isBusy = true;

            if (typeof (tableState.sort.predicate) !== "undefined") {
                $ctrl.searchModel.orderBy = tableState.sort.predicate;
                $ctrl.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }

            console.log('search', $ctrl.searchModel);

            $http.get('api/court/list', {
                params: $ctrl.searchModel
            }).then(function (r) {
                $ctrl.courts = r.data.results;
                $ctrl.searchModel = r.data;
                console.log('courts', $ctrl.courts);
                delete $ctrl.searchModel.results;
            }).finally(function () {
                $ctrl.isBusy = false;
            });
        }

        $ctrl.paged = function paged() {
            $ctrl.search(tableStateRef);
        };

        $ctrl.openModal = function (court) {
            $modal.open({
                component: 'courtEdit',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    court: court
                },
                size: 'md'
            }).result.then(function (result) {
                if (court !== undefined) {
                    angular.extend(court, result);
                } else {
                    $ctrl.courts.unshift(result);
                }
            }, function (reason) {});
        }

        $ctrl.delete = function (court) {
            $confirm({
                title: 'Delete',
                text: 'Are you sure you want to delete ' + court.name + '?'
            }).then(function () {
                $http.delete('/api/court/' + court.id).then(function (r) {
                    var idx = $ctrl.courts.indexOf(court);
                    $ctrl.courts.splice(idx, 1);
                    var myToastMsg = ngToast.success({
                        content: 'Deleted court ' + court.name,
                        dismissButton: true
                    });
                }).catch(function (err) {
                    console.log('Oops. Something went wrong', err);
                    var myToastMsg = ngToast.danger({
                        content: err.data,
                        dismissButton: true
                    });
                });
            });

        }
    }

    module.component('courtList', {
        templateUrl: 'app/courts/court-list.component.html',
        controller: ['$http', '$uibModal', '$confirm', 'ngToast', controller]
    });
})();
//mark.lawrence
//date-input.directive.js

(function () {
    angular.module('app').directive('dateInput', function ($window) {
        return {
            require: '^ngModel',
            restrict: 'A',
            link: function (scope, elm, attrs, ctrl) {
                var moment = $window.moment;
                var dateFormat = attrs.dateInput;

                attrs.$observe('dateInput', function (newValue) {
                    console.log('newValue', newValue);
                    if (dateFormat === newValue || !ctrl.$modelValue) return;

                    dateFormat = newValue;
                    ctrl.$modelValue = moment(ctrl.$setViewValue).format(dateFormat);
                    console.log('datevalue', $ctrl.modelValue);
                });

                ctrl.$formatters.unshift(function (modelValue) {
                    if (!dateFormat || !modelValue) return "";
                    var retVal = moment(modelValue).format(dateFormat);
                    return retVal;
                });

                ctrl.$parsers.unshift(function (viewValue) {
                    var date = moment(viewValue, dateFormat);
                    return (date && date.isValid() && date.year() > 1950) ? date.toDate() : "";
                });
            }
        };
    });
})();
//mark.lawrence
//smart-table.directive.js

(function () {
    angular.module('app').directive("stClearKey", function () {
        return {
            restrict: 'EA',
            require: ['^stTable', '^ngModel'],
            link: function (scope, element, attrs, ctrls) {
                element.on('keydown', function (event) {
                    var ngModel = ctrls[1];
                    var ctrl = ctrls[0];

                    if (event.which === 13) {
                        return ctrl.pipe();
                    }
                    if (event.which === 27) {

                        if (element.context.attributes['st-search'] !== undefined) {
                            return scope.$apply(function () {
                                var fieldName = element.context.attributes['st-search'].value;
                                var tableState = ctrl.tableState();
                                tableState.search.predicateObject[fieldName] = '';
                                return ctrl.pipe();
                            });

                        } else {
                            return scope.$apply(function () {
                                ngModel.$setViewValue(null);
                                ngModel.$render(); // will update the input value as well
                            });

                        }
                    }
                });
            }
        };
    });

    angular.module('app')
        .directive("stResetSearch",
            function () {
                return {
                    restrict: 'EA',
                    require: ['^stTable', '^ngModel'],
                    link: function (scope, element, attrs, ctrls) {
                        return element.bind('click',
                            function () {
                                var model = ctrls[1];
                                var ctrl = ctrls[0];

                                return scope.$apply(function () {
                                    angular.forEach(model.$viewValue,
                                        function (value, key) {
                                            if (key.toLowerCase() === 'page') {
                                                model.$viewValue[key] = 1;
                                            }
                                            if (Array.isArray(value) || _.includes(key.toLowerCase(), 'page')) return;
                                            model.$viewValue[key] = null;
                                        });
                                    var tableState = ctrl.tableState();
                                    tableState.search.predicateObject = {};
                                    tableState.pagination.start = 0;
                                    return ctrl.pipe();
                                });
                            });
                    }
                };
            });

    angular.module('app').directive('stSubmitSearch', ['stConfig', '$timeout', '$parse', function (stConfig, $timeout, $parse) {
        return {
            require: '^stTable',
            link: function (scope, element, attr, ctrl) {
                return element.bind('click',
                    function () {
                        var tableCtrl = ctrl;
                        tableCtrl.pipe();
                    });

            }
        };
    }]);


    angular.module('smart-table')
        .directive('stSearch', ['stConfig', '$timeout', '$parse', function (stConfig, $timeout, $parse) {
            return {
                require: '^stTable',
                link: function (scope, element, attr, ctrl) {
                    var tableCtrl = ctrl;
                    var promise = null;
                    var throttle = attr.stDelay || stConfig.search.delay;
                    var event = attr.stInputEvent || stConfig.search.inputEvent;

                    attr.$observe('stSearch', function (newValue, oldValue) {
                        var input = element[0].value;
                        if (newValue !== oldValue && input) {
                            ctrl.tableState().search = {};
                            tableCtrl.search(input, newValue);
                        }
                    });

                    //table state -> view
                    scope.$watch(function () {
                        return ctrl.tableState().search;
                    }, function (newValue, oldValue) {
                        var predicateExpression = attr.stSearch || '$';
                        if (newValue.predicateObject && $parse(predicateExpression)(newValue.predicateObject) !== element[0].value) {
                            element[0].value = $parse(predicateExpression)(newValue.predicateObject) || '';
                        }
                    }, true);

                    // view -> table state
                    element.bind(event, function (evt) {
                        evt = evt.originalEvent || evt;
                        if (promise !== null) {
                            $timeout.cancel(promise);
                        }

                        promise = $timeout(function () {
                            tableCtrl.search(evt.target.value, attr.stSearch || '');
                            promise = null;
                        }, throttle);
                    });
                }
            };
        }]);

})();
//jurisdiction-edit.component.js
(function () {
    var module = angular.module('app');

    function controller($http) {
        var $ctrl = this;

        $ctrl.title = 'Update Jurisdiction';

        $ctrl.$onInit = function () {
            console.log('jurisdiction edit init', $ctrl);
            if ($ctrl.resolve) {
                $ctrl.jurisdiction = angular.copy($ctrl.resolve.jurisdiction);
            }
            if ($ctrl.jurisdiction === undefined) {
                $ctrl.title = 'New Jurisdiction'
            }
        }

        $ctrl.cancel = function () {
            $ctrl.dismiss();
        }

        $ctrl.save = function () {
            if ($ctrl.jurisdiction.id !== undefined) {
                $http.put('api/jurisdiction', $ctrl.jurisdiction).then(function (r) {
                    $ctrl.modalInstance.close($ctrl.jurisdiction);
                });
            } else {
                $http.post('api/jurisdiction', $ctrl.jurisdiction).then(function (r) {
                    $ctrl.modalInstance.close(r.data);
                });
            }
        }


    }

    module.component('jurisdictionEdit', {
        templateUrl: 'app/jurisdictions/jurisdiction-edit.component.html',
        controller: ['$http', controller],
        bindings: {
            jurisdiction: '<',
            resolve: '<',
            close: '&',
            dismiss: '&',
            modalInstance: '<'
        }
    });
})();
//jurisdiction-list.component.js
(function () {
    var module = angular.module('app');

    function controller($http, $modal, $confirm, ngToast) {
        var $ctrl = this;
        var pageSizeDefault = 10;

        $ctrl.title = 'Jurisdiction Manager';
        $ctrl.subTitle = 'Jurisdictions';
        $ctrl.isBusy = false;

        $ctrl.searchModel = {
            page: 1,
            pageSize: pageSizeDefault,
            orderBy: 'id',
            orderDirection: 'asc'
        };

        $ctrl.$onInit = function () {
            console.log('jurisdiction list init');
            $ctrl.isBusy = true;
        }

        $ctrl.search = function (tableState) {
            tableStateRef = tableState;
            $ctrl.isBusy = true;

            if (typeof (tableState.sort.predicate) !== "undefined") {
                $ctrl.searchModel.orderBy = tableState.sort.predicate;
                $ctrl.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }

            console.log('search', $ctrl.searchModel);

            $http.get('api/jurisdiction/list', {
                params: $ctrl.searchModel
            }).then(function (r) {
                $ctrl.jurisdictions = r.data.results;
                $ctrl.searchModel = r.data;
                delete $ctrl.searchModel.results;
            }).finally(function () {
                $ctrl.isBusy = false;
            });
        }

        $ctrl.paged = function paged() {
            $ctrl.search(tableStateRef);
        };

        $ctrl.openModal = function (jurisdiction) {
            $modal.open({
                component: 'jurisdictionEdit',
                bindings: {
                    modalInstance: "<"
                },
                resolve: {
                    jurisdiction: jurisdiction
                },
                size: 'md'
            }).result.then(function (result) {
                if (jurisdiction === undefined) {
                    $ctrl.jurisdictions.unshift(result);
                } else {
                    angular.extend(jurisdiction, result);
                }
            }, function (reason) {});
        }

        $ctrl.delete = function (jurisdiction) {
            $confirm({
                title: 'Delete',
                text: 'Are you sure you want to delete ' + jurisdiction.name + '?'
            }).then(function () {
                $http.delete('/api/jurisdiction/' + jurisdiction.id).then(function (r) {
                    var idx = $ctrl.jurisdictions.indexOf(jurisdiction);
                    $ctrl.jurisdictions.splice(idx, 1);
                    var myToastMsg = ngToast.success({
                        content: 'Deleted jurisdiction ' + jurisdiction.name,
                        dismissButton: true
                    });
                }).catch(function (err) {
                    console.log('Oops. Something went wrong', err);
                    var myToastMsg = ngToast.danger({
                        content: err.data,
                        dismissButton: true
                    });
                });
            });
        }

    }

    module.component('jurisdictionList', {
        templateUrl: 'app/jurisdictions/jurisdiction-list.component.html',
        controller: ['$http', '$uibModal', '$confirm', 'ngToast', controller]
    });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjYXNlcy9jYXNlLWRldGFpbC5jb21wb25lbnQuanMiLCJjYXNlcy9jYXNlLWVkaXQuY29tcG9uZW50LmpzIiwiY2FzZXMvY2FzZS1saXN0LmNvbXBvbmVudC5qcyIsImNvdXJ0cy9jb3VydC1lZGl0LmNvbXBvbmVudC5qcyIsImNvdXJ0cy9jb3VydC1saXN0LmNvbXBvbmVudC5qcyIsImRpcmVjdGl2ZXMvZGF0ZS1pbnB1dC5qcyIsImRpcmVjdGl2ZXMvc21hcnQtdGFibGUuZGlyZWN0aXZlLmpzIiwianVyaXNkaWN0aW9ucy9qdXJpc2RpY3Rpb24tZWRpdC5jb21wb25lbnQuanMiLCJqdXJpc2RpY3Rpb25zL2p1cmlzZGljdGlvbi1saXN0LmNvbXBvbmVudC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDakVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcsIFtcbiAgICAgICAgLy90aGlyZCBwYXJ0eSBtb2R1bGVzXG4gICAgICAgICd1aS5ib290c3RyYXAnLFxuICAgICAgICAnbmdTYW5pdGl6ZScsXG4gICAgICAgICd1aS5zZWxlY3QnLFxuICAgICAgICAnYW5ndWxhci1jb25maXJtJyxcbiAgICAgICAgJ25nVG9hc3QnLFxuICAgICAgICAnc21hcnQtdGFibGUnXG4gICAgXSk7XG5cbiAgICBtb2R1bGUucnVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ0FwcGxpY2F0aW9uIFN0YXJ0ZWQnKTtcbiAgICB9KVxufSkoKTsiLCIvL2Nhc2UtZGV0YWlsLmNvbXBvbmVudC5qc1xuKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xuXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCwgJG1vZGFsLCB1aWJEYXRlUGFyc2VyLCAkY29uZmlybSwgbmdUb2FzdCkge1xuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xuXG4gICAgICAgICRjdHJsLnRpdGxlID0gJ0Nhc2UgTWFuYWdlcic7XG4gICAgICAgICRjdHJsLnN1YlRpdGxlID0gJ0Nhc2UnO1xuICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcblxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2Nhc2UgZGV0YWlsIGluaXQnKTtcbiAgICAgICAgICAgIHZhciBpZCA9IGxvY2F0aW9uLnBhdGhuYW1lLnNwbGl0KCcvJylbbG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoJy8nKS5sZW5ndGggLSAxXTtcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XG4gICAgICAgICAgICAkaHR0cC5nZXQoJy9hcGkvY2FzZS8nICsgaWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5jYXNlID0gci5kYXRhO1xuICAgICAgICAgICAgfSkuZmluYWxseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLm9wZW5Nb2RhbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgICAgICBjb21wb25lbnQ6ICdjYXNlRWRpdCcsXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZTogJGN0cmwuY2FzZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc2l6ZTogJ21kJ1xuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1cGRhdGVkJywgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZCgkY3RybC5jYXNlLCByZXN1bHQpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikge30pO1xuICAgICAgICB9XG5cbiAgICAgICAgJGN0cmwuYWRkTGl0aWdhbnQgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICAgICAgaWYgKCRjdHJsLnBsYWludGlmZiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2FkZCBwbGFpbnRpZmYnLCAkY3RybC5wbGFpbnRpZmYubmFtZSk7XG4gICAgICAgICAgICAgICAgJGN0cmwucGxhaW50aWZmLmNhc2VJZCA9ICRjdHJsLmNhc2UuaWQ7XG4gICAgICAgICAgICAgICAgJGN0cmwucGxhaW50aWZmLnR5cGUgPSAncGxhaW50aWZmJztcblxuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJy9hcGkvY2FzZS8nICsgJGN0cmwuY2FzZS5pZCArICcvbGl0aWdhbnQnLCAkY3RybC5wbGFpbnRpZmYpXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkY3RybC5jYXNlLnBsYWludGlmZnMudW5zaGlmdChyLmRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJGN0cmwucGxhaW50aWZmID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgkY3RybC5kZWZlbmRhbnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICRjdHJsLmRlZmVuZGFudC5jYXNlSWQgPSAkY3RybC5jYXNlLmlkO1xuICAgICAgICAgICAgICAgICRjdHJsLmRlZmVuZGFudC50eXBlID0gJ2RlZmVuZGFudCc7XG5cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnYWRkIGRlZmVuZGFudCcsICRjdHJsLmRlZmVuZGFudCk7XG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9jYXNlLycgKyAkY3RybC5jYXNlLmlkICsgJy9saXRpZ2FudCcsICRjdHJsLmRlZmVuZGFudClcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjdHJsLmNhc2UuZGVmZW5kYW50cy51bnNoaWZ0KHIuZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkY3RybC5kZWZlbmRhbnQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgJGN0cmwuZGVsZXRlTGl0aWdhbnQgPSBmdW5jdGlvbiAoaXRlbSwgdHlwZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2xpdGlnYW50JywgaXRlbSk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygndHlwZScsIHR5cGUpO1xuICAgICAgICAgICAgJGh0dHAuZGVsZXRlKCcvYXBpL2Nhc2UvJyArICRjdHJsLmNhc2UuaWQgKyAnL2xpdGlnYW50LycgKyBpdGVtLmlkKS50aGVuKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2RlZmVuZGFudCc6XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gJGN0cmwuY2FzZS5kZWZlbmRhbnRzLmluZGV4T2YoaXRlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkY3RybC5jYXNlLmRlZmVuZGFudHMuc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAncGxhaW50aWZmJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSAkY3RybC5jYXNlLnBsYWludGlmZnMuaW5kZXhPZihpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRjdHJsLmNhc2UucGxhaW50aWZmcy5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3Vua25vd24gbGl0aWdhbnQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgLy8gdG9hc3RyLmVycm9yKCdPb3BzLiBFcnJvciBkZWxldGluZyB0YXgnKTtcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vICRjdHJsLmlzQnVzeSA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLmRlbGV0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRjb25maXJtKHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0RlbGV0ZScsXG4gICAgICAgICAgICAgICAgdGV4dDogJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgJyArICRjdHJsLmNhc2UuY2FwdGlvbiArICc/J1xuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAkaHR0cC5kZWxldGUoJy9hcGkvY2FzZS8nICsgJGN0cmwuY2FzZS5pZCkudGhlbihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbXlUb2FzdE1zZyA9IG5nVG9hc3Quc3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnRGVsZXRlZCBjYXNlICcgKyAkY3RybC5jYXNlLmNhcHRpb24sXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNtaXNzQnV0dG9uOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICcvJztcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdPb3BzLiBTb21ldGhpbmcgd2VudCB3cm9uZycsIGVycik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBteVRvYXN0TXNnID0gbmdUb2FzdC5kYW5nZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogZXJyLmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNtaXNzQnV0dG9uOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuICAgIH1cblxuICAgIG1vZHVsZS5jb21wb25lbnQoJ2Nhc2VEZXRhaWwnLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9jYXNlcy9jYXNlLWRldGFpbC5jb21wb25lbnQuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAnJHVpYk1vZGFsJywgJ3VpYkRhdGVQYXJzZXInLCAnJGNvbmZpcm0nLCAnbmdUb2FzdCcsIGNvbnRyb2xsZXJdXG4gICAgfSk7XG59KSgpOyIsIi8vY2FzZS1lZGl0LmNvbXBvbmVudC5qc1xuKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ2FwcCcpO1xuXG4gICAgZnVuY3Rpb24gY29udHJvbGxlcigkaHR0cCwgdWliRGF0ZVBhcnNlcikge1xuICAgICAgICB2YXIgJGN0cmwgPSB0aGlzO1xuICAgICAgICAkY3RybC50aXRsZSA9ICdVcGRhdGUgQ2FzZSc7XG4gICAgICAgICRjdHJsLmRhdGVGb3JtYXQgPSBcIk1NL0REL1lZWVlcIjtcbiAgICAgICAgJGN0cmwuZGF0ZU9wdGlvbnMgPSB7XG4gICAgICAgICAgICBtaW5EYXRlOiAnMTk0MC0wMS0wMSdcbiAgICAgICAgfTtcblxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2Nhc2UgZWRpdCBpbml0Jyk7XG4gICAgICAgICAgICBpZiAoJGN0cmwucmVzb2x2ZSkge1xuICAgICAgICAgICAgICAgICRjdHJsLmNhc2UgPSBhbmd1bGFyLmNvcHkoJGN0cmwucmVzb2x2ZS5jYXNlKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY2FzZScsICRjdHJsLmNhc2UpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCRjdHJsLmNhc2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAkY3RybC5jYXNlLmRhdGVGaWxlZCA9IG5ldyBEYXRlKCRjdHJsLmNhc2UuZGF0ZUZpbGVkKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkY3RybC5jYXNlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0ZUZpbGVkOiBuZXcgRGF0ZSgpXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCRjdHJsLmNhc2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICRjdHJsLnRpdGxlID0gJ05ldyBDYXNlJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJGh0dHAuZ2V0KCcvYXBpL2NvdXJ0L2xpc3QnKS50aGVuKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgJGN0cmwuY291cnRzID0gci5kYXRhO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoJGN0cmwuY2FzZS5pZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgJGh0dHAucHV0KCcvYXBpL2Nhc2UnLCAkY3RybC5jYXNlKS50aGVuKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgICAgICRjdHJsLm1vZGFsSW5zdGFuY2UuY2xvc2Uoci5kYXRhKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJGh0dHAucG9zdCgnL2FwaS9jYXNlJywgJGN0cmwuY2FzZSkudGhlbihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgICAgICAkY3RybC5tb2RhbEluc3RhbmNlLmNsb3NlKHIuZGF0YSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuXG4gICAgfVxuXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnY2FzZUVkaXQnLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9jYXNlcy9jYXNlLWVkaXQuY29tcG9uZW50Lmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiBbJyRodHRwJywgY29udHJvbGxlcl0sXG4gICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICBjYXNlOiAnPCcsXG4gICAgICAgICAgICByZXNvbHZlOiAnPCcsXG4gICAgICAgICAgICBjbG9zZTogJyYnLFxuICAgICAgICAgICAgZGlzbWlzczogJyYnLFxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogJzwnXG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7IiwiLy9jYXNlLWxpc3QuY29tcG9uZW50LmpzXG4oZnVuY3Rpb24gKCkge1xuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XG5cbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRodHRwLCAkbW9kYWwsIG5nVG9hc3QpIHtcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xuXG4gICAgICAgICRjdHJsLnRpdGxlID0gJ0Nhc2UgTWFuYWdlcic7XG4gICAgICAgICRjdHJsLnN1YlRpdGxlID0gJ0Nhc2VzJztcbiAgICAgICAgJGN0cmwuaXNCdXN5ID0gZmFsc2U7XG5cbiAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwgPSB7XG4gICAgICAgICAgICBwYWdlOiAxLFxuICAgICAgICAgICAgcGFnZVNpemU6IHBhZ2VTaXplRGVmYXVsdCxcbiAgICAgICAgICAgIG9yZGVyQnk6ICdpZCcsXG4gICAgICAgICAgICBvcmRlckRpcmVjdGlvbjogJ2Rlc2MnXG4gICAgICAgIH07XG5cbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjYXNlIGxpc3QgaW5pdCcpO1xuICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLnNlYXJjaCA9IGZ1bmN0aW9uICh0YWJsZVN0YXRlKSB7XG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgKHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGUpICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwub3JkZXJCeSA9IHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGU7XG4gICAgICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwub3JkZXJEaXJlY3Rpb24gPSB0YWJsZVN0YXRlLnNvcnQucmV2ZXJzZSA/ICdkZXNjJyA6ICdhc2MnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkaHR0cC5nZXQoJ2FwaS9jYXNlL2xpc3QnLCB7XG4gICAgICAgICAgICAgICAgcGFyYW1zOiAkY3RybC5zZWFyY2hNb2RlbFxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgICRjdHJsLmNhc2VzID0gci5kYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwgPSByLmRhdGE7XG4gICAgICAgICAgICAgICAgZGVsZXRlICRjdHJsLnNlYXJjaE1vZGVsLnJlc3VsdHM7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgJGN0cmwucGFnZWQgPSBmdW5jdGlvbiBwYWdlZCgpIHtcbiAgICAgICAgICAgICRjdHJsLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkY3RybC5vcGVuTW9kYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnY2FzZUVkaXQnLFxuICAgICAgICAgICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6IFwiPFwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2U6ICRjdHJsLmNhc2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzdWx0JywgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICAkY3RybC5jYXNlcy51bnNoaWZ0KHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgdmFyIG15VG9hc3RNc2cgPSBuZ1RvYXN0LnN1Y2Nlc3Moe1xuICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnQWRkZWQgY2FzZSAnICsgcmVzdWx0LmNhcHRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRpc21pc3NCdXR0b246IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHt9KTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnY2FzZUxpc3QnLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2Nhc2VzL2Nhc2UtbGlzdC5jb21wb25lbnQuaHRtbCcsXG4gICAgICAgIGNvbnRyb2xsZXI6IFsnJGh0dHAnLCAnJHVpYk1vZGFsJywgJ25nVG9hc3QnLCBjb250cm9sbGVyXVxuICAgIH0pO1xufSkoKTsiLCIvL2NvdXJ0LWVkaXQuY29tcG9uZW50LmpzXG4oZnVuY3Rpb24gKCkge1xuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XG5cbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRodHRwKSB7XG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XG5cbiAgICAgICAgJGN0cmwudGl0bGUgPSAnVXBkYXRlIENvdXJ0JztcblxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvdXJ0IGVkaXQgaW5pdCcsICRjdHJsKTtcbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL2p1cmlzZGljdGlvbi9saXN0JykudGhlbihmdW5jdGlvbiAocikge1xuICAgICAgICAgICAgICAgICRjdHJsLmp1cmlzZGljdGlvbnMgPSByLmRhdGE7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5jb3VydCA9IGFuZ3VsYXIuY29weSgkY3RybC5yZXNvbHZlLmNvdXJ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgkY3RybC5jb3VydCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgJGN0cmwudGl0bGUgPSAnTmV3IENvdXJ0JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2F2ZScsICRjdHJsLmNvdXJ0KTtcbiAgICAgICAgICAgIGlmICgkY3RybC5jb3VydC5pZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3VwZGF0aW5nIGNvdXJ0JywgJGN0cmwuY291cnQpO1xuICAgICAgICAgICAgICAgICRodHRwLnB1dCgnYXBpL2NvdXJ0JywgJGN0cmwuY291cnQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwubW9kYWxJbnN0YW5jZS5jbG9zZSgkY3RybC5jb3VydCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhZGRpbmcgbmV3IGNvdXJ0JywgJGN0cmwuY291cnQpO1xuICAgICAgICAgICAgICAgICRodHRwLnBvc3QoJ2FwaS9jb3VydCcsICRjdHJsLmNvdXJ0KS50aGVuKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgICAgICRjdHJsLm1vZGFsSW5zdGFuY2UuY2xvc2Uoci5kYXRhKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgbW9kdWxlLmNvbXBvbmVudCgnY291cnRFZGl0Jywge1xuICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvY291cnRzL2NvdXJ0LWVkaXQuY29tcG9uZW50Lmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiBbJyRodHRwJywgY29udHJvbGxlcl0sXG4gICAgICAgIGJpbmRpbmdzOiB7XG4gICAgICAgICAgICBjb3VydDogJzwnLFxuICAgICAgICAgICAgcmVzb2x2ZTogJzwnLFxuICAgICAgICAgICAgY2xvc2U6ICcmJyxcbiAgICAgICAgICAgIGRpc21pc3M6ICcmJyxcbiAgICAgICAgICAgIG1vZGFsSW5zdGFuY2U6ICc8J1xuICAgICAgICB9XG4gICAgfSk7XG59KSgpOyIsIi8vY291cnQtbGlzdC5jb21wb25lbnQuanNcbihmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcblxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJGh0dHAsICRtb2RhbCwgJGNvbmZpcm0sIG5nVG9hc3QpIHtcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xuXG4gICAgICAgICRjdHJsLnRpdGxlID0gJ0NvdXJ0IE1hbmFnZXInO1xuICAgICAgICAkY3RybC5zdWJUaXRsZSA9ICdDb3VydHMnO1xuICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcblxuICAgICAgICAkY3RybC5zZWFyY2hNb2RlbCA9IHtcbiAgICAgICAgICAgIHBhZ2U6IDEsXG4gICAgICAgICAgICBwYWdlU2l6ZTogcGFnZVNpemVEZWZhdWx0LFxuICAgICAgICAgICAgb3JkZXJCeTogJ2lkJyxcbiAgICAgICAgICAgIG9yZGVyRGlyZWN0aW9uOiAnZGVzYydcbiAgICAgICAgfTtcblxuICAgICAgICAkY3RybC4kb25Jbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvdXJ0IGxpc3QgaW5pdCcpO1xuICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLnNlYXJjaCA9IGZ1bmN0aW9uICh0YWJsZVN0YXRlKSB7XG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcbiAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IHRydWU7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgKHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGUpICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwub3JkZXJCeSA9IHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGU7XG4gICAgICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwub3JkZXJEaXJlY3Rpb24gPSB0YWJsZVN0YXRlLnNvcnQucmV2ZXJzZSA/ICdkZXNjJyA6ICdhc2MnO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2VhcmNoJywgJGN0cmwuc2VhcmNoTW9kZWwpO1xuXG4gICAgICAgICAgICAkaHR0cC5nZXQoJ2FwaS9jb3VydC9saXN0Jywge1xuICAgICAgICAgICAgICAgIHBhcmFtczogJGN0cmwuc2VhcmNoTW9kZWxcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5jb3VydHMgPSByLmRhdGEucmVzdWx0cztcbiAgICAgICAgICAgICAgICAkY3RybC5zZWFyY2hNb2RlbCA9IHIuZGF0YTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnY291cnRzJywgJGN0cmwuY291cnRzKTtcbiAgICAgICAgICAgICAgICBkZWxldGUgJGN0cmwuc2VhcmNoTW9kZWwucmVzdWx0cztcbiAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRjdHJsLmlzQnVzeSA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAkY3RybC5wYWdlZCA9IGZ1bmN0aW9uIHBhZ2VkKCkge1xuICAgICAgICAgICAgJGN0cmwuc2VhcmNoKHRhYmxlU3RhdGVSZWYpO1xuICAgICAgICB9O1xuXG4gICAgICAgICRjdHJsLm9wZW5Nb2RhbCA9IGZ1bmN0aW9uIChjb3VydCkge1xuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogJ2NvdXJ0RWRpdCcsXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgY291cnQ6IGNvdXJ0XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzaXplOiAnbWQnXG4gICAgICAgICAgICB9KS5yZXN1bHQudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvdXJ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoY291cnQsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwuY291cnRzLnVuc2hpZnQocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7fSk7XG4gICAgICAgIH1cblxuICAgICAgICAkY3RybC5kZWxldGUgPSBmdW5jdGlvbiAoY291cnQpIHtcbiAgICAgICAgICAgICRjb25maXJtKHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0RlbGV0ZScsXG4gICAgICAgICAgICAgICAgdGV4dDogJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgJyArIGNvdXJ0Lm5hbWUgKyAnPydcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRodHRwLmRlbGV0ZSgnL2FwaS9jb3VydC8nICsgY291cnQuaWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9ICRjdHJsLmNvdXJ0cy5pbmRleE9mKGNvdXJ0KTtcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwuY291cnRzLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbXlUb2FzdE1zZyA9IG5nVG9hc3Quc3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnRGVsZXRlZCBjb3VydCAnICsgY291cnQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc21pc3NCdXR0b246IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnT29wcy4gU29tZXRoaW5nIHdlbnQgd3JvbmcnLCBlcnIpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbXlUb2FzdE1zZyA9IG5nVG9hc3QuZGFuZ2VyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGVyci5kYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzbWlzc0J1dHRvbjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBtb2R1bGUuY29tcG9uZW50KCdjb3VydExpc3QnLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2NvdXJ0cy9jb3VydC1saXN0LmNvbXBvbmVudC5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsICckdWliTW9kYWwnLCAnJGNvbmZpcm0nLCAnbmdUb2FzdCcsIGNvbnRyb2xsZXJdXG4gICAgfSk7XG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxuLy9kYXRlLWlucHV0LmRpcmVjdGl2ZS5qc1xuXG4oZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoJ2RhdGVJbnB1dCcsIGZ1bmN0aW9uICgkd2luZG93KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXF1aXJlOiAnXm5nTW9kZWwnLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxtLCBhdHRycywgY3RybCkge1xuICAgICAgICAgICAgICAgIHZhciBtb21lbnQgPSAkd2luZG93Lm1vbWVudDtcbiAgICAgICAgICAgICAgICB2YXIgZGF0ZUZvcm1hdCA9IGF0dHJzLmRhdGVJbnB1dDtcblxuICAgICAgICAgICAgICAgIGF0dHJzLiRvYnNlcnZlKCdkYXRlSW5wdXQnLCBmdW5jdGlvbiAobmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25ld1ZhbHVlJywgbmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0ZUZvcm1hdCA9PT0gbmV3VmFsdWUgfHwgIWN0cmwuJG1vZGVsVmFsdWUpIHJldHVybjtcblxuICAgICAgICAgICAgICAgICAgICBkYXRlRm9ybWF0ID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJG1vZGVsVmFsdWUgPSBtb21lbnQoY3RybC4kc2V0Vmlld1ZhbHVlKS5mb3JtYXQoZGF0ZUZvcm1hdCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdkYXRldmFsdWUnLCAkY3RybC5tb2RlbFZhbHVlKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGN0cmwuJGZvcm1hdHRlcnMudW5zaGlmdChmdW5jdGlvbiAobW9kZWxWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWRhdGVGb3JtYXQgfHwgIW1vZGVsVmFsdWUpIHJldHVybiBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmV0VmFsID0gbW9tZW50KG1vZGVsVmFsdWUpLmZvcm1hdChkYXRlRm9ybWF0KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJldFZhbDtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGN0cmwuJHBhcnNlcnMudW5zaGlmdChmdW5jdGlvbiAodmlld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkYXRlID0gbW9tZW50KHZpZXdWYWx1ZSwgZGF0ZUZvcm1hdCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGF0ZSAmJiBkYXRlLmlzVmFsaWQoKSAmJiBkYXRlLnllYXIoKSA+IDE5NTApID8gZGF0ZS50b0RhdGUoKSA6IFwiXCI7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSk7XG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxuLy9zbWFydC10YWJsZS5kaXJlY3RpdmUuanNcblxuKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKFwic3RDbGVhcktleVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcbiAgICAgICAgICAgIHJlcXVpcmU6IFsnXnN0VGFibGUnLCAnXm5nTW9kZWwnXSxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmxzKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmdNb2RlbCA9IGN0cmxzWzFdO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IGN0cmxzWzBdO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCA9PT0gMTMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLnBpcGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggPT09IDI3KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50LmNvbnRleHQuYXR0cmlidXRlc1snc3Qtc2VhcmNoJ10gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmllbGROYW1lID0gZWxlbWVudC5jb250ZXh0LmF0dHJpYnV0ZXNbJ3N0LXNlYXJjaCddLnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVTdGF0ZSA9IGN0cmwudGFibGVTdGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3RbZmllbGROYW1lXSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3RybC5waXBlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5nTW9kZWwuJHNldFZpZXdWYWx1ZShudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmdNb2RlbC4kcmVuZGVyKCk7IC8vIHdpbGwgdXBkYXRlIHRoZSBpbnB1dCB2YWx1ZSBhcyB3ZWxsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH0pO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoXCJzdFJlc2V0U2VhcmNoXCIsXG4gICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmU6IFsnXnN0VGFibGUnLCAnXm5nTW9kZWwnXSxcbiAgICAgICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmJpbmQoJ2NsaWNrJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtb2RlbCA9IGN0cmxzWzFdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3RybCA9IGN0cmxzWzBdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKG1vZGVsLiR2aWV3VmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleS50b0xvd2VyQ2FzZSgpID09PSAncGFnZScpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLiR2aWV3VmFsdWVba2V5XSA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpIHx8IF8uaW5jbHVkZXMoa2V5LnRvTG93ZXJDYXNlKCksICdwYWdlJykpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwuJHZpZXdWYWx1ZVtrZXldID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZVN0YXRlID0gY3RybC50YWJsZVN0YXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlU3RhdGUucGFnaW5hdGlvbi5zdGFydCA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3RybC5waXBlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZSgnc3RTdWJtaXRTZWFyY2gnLCBbJ3N0Q29uZmlnJywgJyR0aW1lb3V0JywgJyRwYXJzZScsIGZ1bmN0aW9uIChzdENvbmZpZywgJHRpbWVvdXQsICRwYXJzZSkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVxdWlyZTogJ15zdFRhYmxlJyxcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0ciwgY3RybCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LmJpbmQoJ2NsaWNrJyxcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlQ3RybCA9IGN0cmw7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUN0cmwucGlwZSgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1dKTtcblxuXG4gICAgYW5ndWxhci5tb2R1bGUoJ3NtYXJ0LXRhYmxlJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnc3RTZWFyY2gnLCBbJ3N0Q29uZmlnJywgJyR0aW1lb3V0JywgJyRwYXJzZScsIGZ1bmN0aW9uIChzdENvbmZpZywgJHRpbWVvdXQsICRwYXJzZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZXF1aXJlOiAnXnN0VGFibGUnLFxuICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0ciwgY3RybCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGFibGVDdHJsID0gY3RybDtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGhyb3R0bGUgPSBhdHRyLnN0RGVsYXkgfHwgc3RDb25maWcuc2VhcmNoLmRlbGF5O1xuICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnQgPSBhdHRyLnN0SW5wdXRFdmVudCB8fCBzdENvbmZpZy5zZWFyY2guaW5wdXRFdmVudDtcblxuICAgICAgICAgICAgICAgICAgICBhdHRyLiRvYnNlcnZlKCdzdFNlYXJjaCcsIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9IGVsZW1lbnRbMF0udmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlICYmIGlucHV0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC50YWJsZVN0YXRlKCkuc2VhcmNoID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVDdHJsLnNlYXJjaChpbnB1dCwgbmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvL3RhYmxlIHN0YXRlIC0+IHZpZXdcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLnRhYmxlU3RhdGUoKS5zZWFyY2g7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcmVkaWNhdGVFeHByZXNzaW9uID0gYXR0ci5zdFNlYXJjaCB8fCAnJCc7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3VmFsdWUucHJlZGljYXRlT2JqZWN0ICYmICRwYXJzZShwcmVkaWNhdGVFeHByZXNzaW9uKShuZXdWYWx1ZS5wcmVkaWNhdGVPYmplY3QpICE9PSBlbGVtZW50WzBdLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudFswXS52YWx1ZSA9ICRwYXJzZShwcmVkaWNhdGVFeHByZXNzaW9uKShuZXdWYWx1ZS5wcmVkaWNhdGVPYmplY3QpIHx8ICcnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyB2aWV3IC0+IHRhYmxlIHN0YXRlXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYmluZChldmVudCwgZnVuY3Rpb24gKGV2dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXZ0ID0gZXZ0Lm9yaWdpbmFsRXZlbnQgfHwgZXZ0O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHByb21pc2UgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwocHJvbWlzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHByb21pc2UgPSAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVDdHJsLnNlYXJjaChldnQudGFyZ2V0LnZhbHVlLCBhdHRyLnN0U2VhcmNoIHx8ICcnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9taXNlID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIHRocm90dGxlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xuXG59KSgpOyIsIi8vanVyaXNkaWN0aW9uLWVkaXQuY29tcG9uZW50LmpzXG4oZnVuY3Rpb24gKCkge1xuICAgIHZhciBtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnYXBwJyk7XG5cbiAgICBmdW5jdGlvbiBjb250cm9sbGVyKCRodHRwKSB7XG4gICAgICAgIHZhciAkY3RybCA9IHRoaXM7XG5cbiAgICAgICAgJGN0cmwudGl0bGUgPSAnVXBkYXRlIEp1cmlzZGljdGlvbic7XG5cbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdqdXJpc2RpY3Rpb24gZWRpdCBpbml0JywgJGN0cmwpO1xuICAgICAgICAgICAgaWYgKCRjdHJsLnJlc29sdmUpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5qdXJpc2RpY3Rpb24gPSBhbmd1bGFyLmNvcHkoJGN0cmwucmVzb2x2ZS5qdXJpc2RpY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCRjdHJsLmp1cmlzZGljdGlvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgJGN0cmwudGl0bGUgPSAnTmV3IEp1cmlzZGljdGlvbidcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRjdHJsLmRpc21pc3MoKTtcbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoJGN0cmwuanVyaXNkaWN0aW9uLmlkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5wdXQoJ2FwaS9qdXJpc2RpY3Rpb24nLCAkY3RybC5qdXJpc2RpY3Rpb24pLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwubW9kYWxJbnN0YW5jZS5jbG9zZSgkY3RybC5qdXJpc2RpY3Rpb24pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5wb3N0KCdhcGkvanVyaXNkaWN0aW9uJywgJGN0cmwuanVyaXNkaWN0aW9uKS50aGVuKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgICAgICAgICAgICAgICRjdHJsLm1vZGFsSW5zdGFuY2UuY2xvc2Uoci5kYXRhKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cbiAgICB9XG5cbiAgICBtb2R1bGUuY29tcG9uZW50KCdqdXJpc2RpY3Rpb25FZGl0Jywge1xuICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9qdXJpc2RpY3Rpb25zL2p1cmlzZGljdGlvbi1lZGl0LmNvbXBvbmVudC5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogWyckaHR0cCcsIGNvbnRyb2xsZXJdLFxuICAgICAgICBiaW5kaW5nczoge1xuICAgICAgICAgICAganVyaXNkaWN0aW9uOiAnPCcsXG4gICAgICAgICAgICByZXNvbHZlOiAnPCcsXG4gICAgICAgICAgICBjbG9zZTogJyYnLFxuICAgICAgICAgICAgZGlzbWlzczogJyYnLFxuICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogJzwnXG4gICAgICAgIH1cbiAgICB9KTtcbn0pKCk7IiwiLy9qdXJpc2RpY3Rpb24tbGlzdC5jb21wb25lbnQuanNcbihmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdhcHAnKTtcblxuICAgIGZ1bmN0aW9uIGNvbnRyb2xsZXIoJGh0dHAsICRtb2RhbCwgJGNvbmZpcm0sIG5nVG9hc3QpIHtcbiAgICAgICAgdmFyICRjdHJsID0gdGhpcztcbiAgICAgICAgdmFyIHBhZ2VTaXplRGVmYXVsdCA9IDEwO1xuXG4gICAgICAgICRjdHJsLnRpdGxlID0gJ0p1cmlzZGljdGlvbiBNYW5hZ2VyJztcbiAgICAgICAgJGN0cmwuc3ViVGl0bGUgPSAnSnVyaXNkaWN0aW9ucyc7XG4gICAgICAgICRjdHJsLmlzQnVzeSA9IGZhbHNlO1xuXG4gICAgICAgICRjdHJsLnNlYXJjaE1vZGVsID0ge1xuICAgICAgICAgICAgcGFnZTogMSxcbiAgICAgICAgICAgIHBhZ2VTaXplOiBwYWdlU2l6ZURlZmF1bHQsXG4gICAgICAgICAgICBvcmRlckJ5OiAnaWQnLFxuICAgICAgICAgICAgb3JkZXJEaXJlY3Rpb246ICdhc2MnXG4gICAgICAgIH07XG5cbiAgICAgICAgJGN0cmwuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdqdXJpc2RpY3Rpb24gbGlzdCBpbml0Jyk7XG4gICAgICAgICAgICAkY3RybC5pc0J1c3kgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgJGN0cmwuc2VhcmNoID0gZnVuY3Rpb24gKHRhYmxlU3RhdGUpIHtcbiAgICAgICAgICAgIHRhYmxlU3RhdGVSZWYgPSB0YWJsZVN0YXRlO1xuICAgICAgICAgICAgJGN0cmwuaXNCdXN5ID0gdHJ1ZTtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiAodGFibGVTdGF0ZS5zb3J0LnByZWRpY2F0ZSkgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5zZWFyY2hNb2RlbC5vcmRlckJ5ID0gdGFibGVTdGF0ZS5zb3J0LnByZWRpY2F0ZTtcbiAgICAgICAgICAgICAgICAkY3RybC5zZWFyY2hNb2RlbC5vcmRlckRpcmVjdGlvbiA9IHRhYmxlU3RhdGUuc29ydC5yZXZlcnNlID8gJ2Rlc2MnIDogJ2FzYyc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZWFyY2gnLCAkY3RybC5zZWFyY2hNb2RlbCk7XG5cbiAgICAgICAgICAgICRodHRwLmdldCgnYXBpL2p1cmlzZGljdGlvbi9saXN0Jywge1xuICAgICAgICAgICAgICAgIHBhcmFtczogJGN0cmwuc2VhcmNoTW9kZWxcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5qdXJpc2RpY3Rpb25zID0gci5kYXRhLnJlc3VsdHM7XG4gICAgICAgICAgICAgICAgJGN0cmwuc2VhcmNoTW9kZWwgPSByLmRhdGE7XG4gICAgICAgICAgICAgICAgZGVsZXRlICRjdHJsLnNlYXJjaE1vZGVsLnJlc3VsdHM7XG4gICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkY3RybC5pc0J1c3kgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgJGN0cmwucGFnZWQgPSBmdW5jdGlvbiBwYWdlZCgpIHtcbiAgICAgICAgICAgICRjdHJsLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkY3RybC5vcGVuTW9kYWwgPSBmdW5jdGlvbiAoanVyaXNkaWN0aW9uKSB7XG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiAnanVyaXNkaWN0aW9uRWRpdCcsXG4gICAgICAgICAgICAgICAgYmluZGluZ3M6IHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxJbnN0YW5jZTogXCI8XCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAganVyaXNkaWN0aW9uOiBqdXJpc2RpY3Rpb25cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNpemU6ICdtZCdcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBpZiAoanVyaXNkaWN0aW9uID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgJGN0cmwuanVyaXNkaWN0aW9ucy51bnNoaWZ0KHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoanVyaXNkaWN0aW9uLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHt9KTtcbiAgICAgICAgfVxuXG4gICAgICAgICRjdHJsLmRlbGV0ZSA9IGZ1bmN0aW9uIChqdXJpc2RpY3Rpb24pIHtcbiAgICAgICAgICAgICRjb25maXJtKHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0RlbGV0ZScsXG4gICAgICAgICAgICAgICAgdGV4dDogJ0FyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byBkZWxldGUgJyArIGp1cmlzZGljdGlvbi5uYW1lICsgJz8nXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAkaHR0cC5kZWxldGUoJy9hcGkvanVyaXNkaWN0aW9uLycgKyBqdXJpc2RpY3Rpb24uaWQpLnRoZW4oZnVuY3Rpb24gKHIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9ICRjdHJsLmp1cmlzZGljdGlvbnMuaW5kZXhPZihqdXJpc2RpY3Rpb24pO1xuICAgICAgICAgICAgICAgICAgICAkY3RybC5qdXJpc2RpY3Rpb25zLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbXlUb2FzdE1zZyA9IG5nVG9hc3Quc3VjY2Vzcyh7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50OiAnRGVsZXRlZCBqdXJpc2RpY3Rpb24gJyArIGp1cmlzZGljdGlvbi5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzbWlzc0J1dHRvbjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdPb3BzLiBTb21ldGhpbmcgd2VudCB3cm9uZycsIGVycik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBteVRvYXN0TXNnID0gbmdUb2FzdC5kYW5nZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogZXJyLmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNtaXNzQnV0dG9uOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIG1vZHVsZS5jb21wb25lbnQoJ2p1cmlzZGljdGlvbkxpc3QnLCB7XG4gICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2p1cmlzZGljdGlvbnMvanVyaXNkaWN0aW9uLWxpc3QuY29tcG9uZW50Lmh0bWwnLFxuICAgICAgICBjb250cm9sbGVyOiBbJyRodHRwJywgJyR1aWJNb2RhbCcsICckY29uZmlybScsICduZ1RvYXN0JywgY29udHJvbGxlcl1cbiAgICB9KTtcbn0pKCk7Il19
